@(data: models.DisposeViewModel,
        disposeForm: Form[models.DisposeFormModelPrivate],
        dateService: uk.gov.dvla.vehicles.presentation.common.services.DateService,
        isPrivateKeeper: Boolean,
        submitCall: Call,
        backCall: Call)(implicit lang: Lang,
        token: uk.gov.dvla.vehicles.presentation.common.filters.CsrfPreventionAction.CsrfPreventionToken,
        config: utils.helpers.Config)

@import models.DisposeFormModel.Form.BackId
@import models.DisposeFormModel.Form.ConsentId
@import models.DisposeFormModel.Form.DateOfDisposalId
@import models.DisposeFormModel.Form.DateOfDisposalYearsIntoThePast
@import models.DisposeFormModel.Form.LossOfRegistrationConsentId
@import models.DisposeFormModel.Form.MileageId
@import models.DisposeFormModel.Form.SubmitId
@import models.DisposeFormModel.Form.TodaysDateOfDisposal
@import models.DisposeFormModel.Form.EmailOptionId
@import models.DisposeFormModel.Form.EmailId
@import views.html.disposal_of_vehicle.main
@import uk.gov.dvla.vehicles.presentation.common
@import common.mappings.Email.EmailMaxLength
@import common.mappings.Mileage
@import common.views.helpers.BaseTemplate.fieldConstructor
@import common.views.html.widgets.base.valtechDeclareCheck
@import common.views.html.widgets.base.valtechInputText
@import common.views.html.widgets.dates.inputDayMonthYearTextbox
@import common.views.html.widgets.base.csrfTokenHiddenField
@import views.html.helper.form
@import views.html.common.vehicle_detail_playback
@import common.views.html.widgets.optionalToggle
@import common.views.html.widgets.email

@main(
    progress = Some(Messages("disposal_progress_5")),
    title = Messages("disposal_dispose.title"),
    currentForm = Some(disposeForm)
) {
    <h1>@Messages("disposal_dispose.title")</h1>

    @form(action = submitCall) {
        @csrfTokenHiddenField()

        <script src="@controllers.StaticAssets.versioned(config.assetsUrl)("lib/vehicles-presentation-common/javascripts/autofill-todays-date.js")" type="text/javascript"></script>

        <div class="two-col clearfix">

            <div class="disposal-info first-col">
                @vehicle_detail_playback(data)

                <dl class="playback">
                    <dt><h2>@Messages("disposal_vehiclelookup.p2")</h2></dt>
                    <dt>@Messages("disposal_vehiclelookup.tradernamelabel")</dt>
                    <dd>@data.dealerName</dd>
                    <dt>@Messages("disposal_vehiclelookup.traderaddresslabel")</dt>
                    <dd>@for(addr <- data.dealerAddress) {@addr<br/>}</dd>
                </dl>

                <div class="alert-warning">
                    <p>@Messages("disposal_dispose.warning")</p>
                </div>
            </div>

            <div class="disposal-form second-col uppercase-input">
                @if(isPrivateKeeper) {
                    <div class="hidden">
                        @valtechDeclareCheck(disposeForm(ConsentId),
                            args = Map(
                                '_label -> Messages("disposal_dispose.consent"),
                                'checked -> "checked"
                            )
                        )
                    </div>
                } else {
                    @valtechDeclareCheck(disposeForm(ConsentId),
                        args = Map(
                            '_showConstraints -> false,
                            '_label -> Messages("disposal_dispose.consent")
                        )
                    )
                }

                @valtechDeclareCheck(disposeForm(LossOfRegistrationConsentId),
                    args = Map(
                        '_showConstraints -> false
                    ) ++
                   (if(isPrivateKeeper)
                      Map('_label -> Messages("disposal_dispose.loss_of_registration.privateKeeper.consent"))
                   else
                      Map('_label -> Messages("disposal_dispose.loss_of_registration.consent"))
                   )
                )

                <div id="@DateOfDisposalId">
                    @inputDayMonthYearTextbox(
                        field =disposeForm(DateOfDisposalId),
                        args = Map(
                            '_label -> Messages("disposal_dispose.dateofdisposal.label")
                        ),
                        dateService = dateService,
                        showTodaysDateButton = !isPrivateKeeper,
                        showTodaysDateButtonId = Some(TodaysDateOfDisposal),
                        hintText = Some(Messages("disposal_dispose.dateofdisposal.hint"))
                    )
                </div>


                @optionalToggle(
                    disposeForm(EmailOptionId),
                    Messages("acquire_businesskeeperdetails.traderemailoption"),
                    Messages("acquire_businesskeeperdetails.traderemailoption.yes"),
                    Messages("acquire_businesskeeperdetails.traderemailoption.no"),
                    email(
                        disposeForm(EmailId),
                        labelText = Messages("acquire_businesskeeperdetails.email"),
                        hintText = None,
                        args = Map('maxLength -> EmailMaxLength)
                    )
                )


                @valtechInputText(disposeForm(MileageId), args =
                        Map(
                          '_label -> Messages("disposal_dispose.mileage.label"),
                          '_showConstraints -> false,
                          'class -> "ga-track-optional-text",
                          Symbol("ga-action") -> "mileage",
                          'typeTel -> true,
                          'maxLength -> Mileage.MaxLength // Must be set independently of the pattern as the pattern is only checked when the user submits.
                          //'title -> Messages("disposal_dispose.mileage.validation")
                        ) ++
                   (if(config.isHtml5ValidationEnabled) Map('pattern -> Mileage.Pattern) else Nil)
                )

                @{
                    /* Note primary button moved to first button as per https://www.gov.uk/service-manual/user-centered-design/resources/forms.html#buttons */
                }
                <div class="form-steps">
                    <button id="@SubmitId" type="submit" name="action" class="button">@Messages("disposal_dispose.submitbutton")</button>
                    <br/>
                    <a class="back" id="@BackId" href="@backCall">@Messages("disposal_dispose.backbutton")</a>

                    <div class="two-col-spacer">
                    </div>
                </div>
            </div>
        </div>
    }

    <script src="@controllers.StaticAssets.versioned(config.assetsUrl)("javascripts/firefox-dont-cache-page.js")"
            type="text/javascript">
    </script>
}
